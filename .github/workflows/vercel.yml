name: Vercel Deployment with Logs

on:
  deployment_status:

jobs:
  notify-with-logs:
    runs-on: ubuntu-latest
    if: github.event.deployment_status.state == 'failure'
    
    steps:
      - name: Get Vercel Deployment Logs
        id: logs
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        run: |
          # Extract deployment ID from URL
          DEPLOYMENT_URL="${{ github.event.deployment_status.target_url }}"
          # Get logs from Vercel API (requires VERCEL_TOKEN)
          # This is optional and requires additional setup
          echo "logs=Check Vercel dashboard for detailed logs" >> $GITHUB_OUTPUT

      - name: Send Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          curl -H "Content-Type: application/json" \
          -X POST \
          -d "{
            \"embeds\": [{
              \"title\": \"ðŸš¨ Vercel Deployment Failed\",
              \"color\": 15158332,
              \"fields\": [
                {
                  \"name\": \"Repository\",
                  \"value\": \"${{ github.repository }}\"
                },
                {
                  \"name\": \"Logs\",
                  \"value\": \"${{ steps.logs.outputs.logs }}\"
                },
                {
                  \"name\": \"View Details\",
                  \"value\": \"[Vercel Dashboard](${{ github.event.deployment_status.target_url }})\"
                }
              ]
            }]
          }" \
          $DISCORD_WEBHOOK